<%# app/views/validators/analytics.html.erb %>
<div class="container mx-auto px-4 space-y-8 mb-8">

  <div class="flex items-center mb-6 mt-8">
    <%= link_to validator_path(@validator.address), class: "mr-3 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" do %>
      <svg class="w-5 h-5 text-gray-600 dark:text-gray-300" viewBox="0 0 36 40" xmlns="http://www.w3.org/2000/svg">
        <path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M24.5118 8.82165C25.1627 9.47253 25.1627 10.5278 24.5118 11.1787L15.6904 20.0002L24.5118 28.8217C25.1627 29.4725 25.1627 30.5278 24.5118 31.1787C23.861 31.8295 22.8057 31.8295 22.1548 31.1787L12.1548 21.1787C11.5039 20.5278 11.5039 19.4725 12.1548 18.8217L22.1548 8.82165C22.8057 8.17078 23.861 8.17078 24.5118 8.82165Z"></path>
      </svg>
    <% end %>
    <div>
      <h1 class="text-2xl font-bold"><%= @validator.name %> <%= t('analytics') %></h1>
      <%= render partial: "validators/address_link_copy", locals: { validator: @validator } %>
    </div>
  </div>

  <div class="bg-white rounded-lg shadow p-6 dark:bg-gray-700">
    <div data-controller="analytics--rewards-history-chart"
         data-analytics--rewards-history-chart-address-value="<%= @validator.address %>"
         data-rewards="<%= @rewards_history.pluck(:amount).map { |amt| amt.to_f / 100_000_000 }.to_json %>"
         data-dates="<%= @rewards_history.pluck(:reward_datetime).map { |d| d.strftime('%m/%d %H:%M') }.to_json %>">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-lg font-semibold">Rewards History</h2>
        <% if @available_time_ranges.any? %>
          <select
            data-analytics--rewards-history-chart-target="timeRange"
            data-action="change->analytics--rewards-history-chart#updateTimeRange"
            class="bg-white border border-gray-300 rounded-md py-1 px-3 text-sm dark:bg-gray-600 dark:border-gray-500 dark:text-gray-200 w-42"
          >
            <% @available_time_ranges.each do |range| %>
              <option value="<%= range[:value] %>"><%= range[:label] %></option>
            <% end %>
          </select>
        <% end %>
      </div>
      <div>
        <canvas data-analytics--rewards-history-chart-target="chart" class="h-64"></canvas>
      </div>
    </div>
  </div>

  <div class="bg-white rounded-lg shadow p-6 dark:bg-gray-700">
    <h2 class="text-lg font-semibold mb-4">Performance Metrics</h2>
    <div
      data-controller="analytics--performance-metrics-chart"
      data-analytics--performance-metrics-chart-address-value="<%= @validator.address %>"
    >
      <canvas data-analytics--performance-metrics-chart-target="chart" class="h-64"></canvas>
    </div>
  </div>

  <div class="bg-white rounded-lg shadow p-6 dark:bg-gray-700">
    <h2 class="text-lg font-semibold mb-4">Block Production</h2>
    <div data-controller="analytics--block-production-chart"
         data-analytics--block-production-chart-address-value="<%= @validator.address %>"
    >
      <canvas data-analytics--block-production-chart-target="chart" class="h-64"></canvas>
    </div>
  </div>

  <div class="bg-white rounded-lg shadow p-6 dark:bg-gray-700">
    <h2 class="text-lg font-semibold mb-4">Active Stake History</h2>
    <div data-controller="analytics--active-stake-history-chart">
      <canvas data-analytics--active-stake-history-chart-target="chart" class="h-64"></canvas>
    </div>
  </div>

  <div class="bg-white rounded-lg shadow p-6 dark:bg-gray-700">
    <h2 class="text-lg font-semibold mb-4">Voting Participation</h2>
    <div data-controller="analytics--voting-participation-chart">
      <canvas data-analytics--voting-participation-chart-target="chart" class="h-64"></canvas>
    </div>
  </div>

  <div class="bg-white rounded-lg shadow p-6  dark:bg-gray-700">
    <h2 class="text-lg font-semibold mb-4">Balance vs Rewards</h2>
    <div data-controller="analytics--balance-rewards-chart">
      <canvas data-analytics--balance-rewards-chart-target="chart" class="h-64"></canvas>
    </div>
  </div>

</div>
